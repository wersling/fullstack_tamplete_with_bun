name: Release Build

on:
  release:
    types: [published]
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  build-and-release:
    name: æ„å»ºç”Ÿäº§ç‰ˆæœ¬
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkoutä»£ç 
        uses: actions/checkout@v4

      - name: ğŸ—ï¸ å®‰è£… Bun
        uses: oven-sh/setup-bun@v2
        with:
          bun-version: latest

      - name: ğŸ“¦ å®‰è£…æ‰€æœ‰ä¾èµ–
        run: bun run install:all

      - name: ğŸ—ï¸ æ„å»ºç”Ÿäº§ç‰ˆæœ¬
        run: bun run build
        env:
          NODE_ENV: production

      - name: ğŸ“¦ æ‰“åŒ…åç«¯
        run: |
          cd backend
          tar -czf ../backend-${{ github.ref_name }}.tar.gz dist/ package.json bun.lock drizzle/

      - name: ğŸ“¦ æ‰“åŒ…å‰ç«¯
        run: |
          cd frontend
          tar -czf ../frontend-${{ github.ref_name }}.tar.gz dist/

      - name: ğŸ“¤ ä¸Šä¼ æ„å»ºäº§ç‰©åˆ° Release
        uses: softprops/action-gh-release@v1
        if: github.event_name == 'release'
        with:
          files: |
            backend-${{ github.ref_name }}.tar.gz
            frontend-${{ github.ref_name }}.tar.gz
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: âœ… å‘å¸ƒæˆåŠŸ
        run: |
          echo "ğŸ‰ ç”Ÿäº§ç‰ˆæœ¬æ„å»ºæˆåŠŸï¼"
          echo "åç«¯åŒ…: backend-${{ github.ref_name }}.tar.gz"
          echo "å‰ç«¯åŒ…: frontend-${{ github.ref_name }}.tar.gz"





